ã€Ž ROUTER ã€

ã€Š ð™Šð™£ ð™©ð™ð™š ð™§ð™¤ð™ªð™©ð™šð™§ ð™¬ð™žð™¡ð™¡ ð™—ð™š ð™¬ð™ð™šð™§ð™š ð™–ð™¡ð™¡ ð™©ð™ð™š ð™žð™£ð™›ð™¤ð™§ð™¢ð™–ð™©ð™žð™¤ð™£ ð™šð™£ð™©ð™šð™§ð™¨ ð™–ð™£ð™™ ð™¡ð™šð™–ð™«ð™šð™¨ ð™›ð™§ð™¤ð™¢ ð™¢ð™® ð™¥ð™§ð™žð™«ð™–ð™©ð™š ð™£ð™šð™©ð™¬ð™¤ð™§ð™ !
 ð™›ð™¤ð™§ ð™—ð™šð™œð™žð™£ð™£ð™žð™£ð™œ, ð™„'ð™¡ð™¡ ð™˜ð™¤ð™£ð™›ð™žð™œð™ªð™§ð™š ð™‰ð˜¼ð™ ð™›ð™¤ð™§ ð™©ð™ð™š ð˜¿ð™ˆð™• ð™–ð™£ð™™ ð™©ð™ð™š ð™¤ð™©ð™ð™šð™§ ð™¥ð™§ð™žð™«ð™–ð™©ð™š ð™£ð™šð™©ð™¬ð™¤ð™§ð™  ð™¢ð™–ð™˜ð™ð™žð™£ð™šð™¨. ã€‹
 
 â‡¨ AWS: Actions > Networking > Change source/destination checking > STOP (This will allow NAT)
 â‡¨ sudo hostnamectl set-hostname control.enta.pt (Server Domain)
 â‡¨ nano keypair.pem (Inside paste your private key that you used to connect to the machine)
 â‡¨ sudo chmod 600 keypair.pem (Give Permissions to the key file)
 
 â‡¨ sudo su - (Root user)
 â‡¨ yum upgrade -y (Update system)
 â‡¨ yum install iptables-services
 â‡¨ systemctl enable --now iptables
 â‡¨ iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
 â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiport --dport 21 -j DNAT --to-destination 10.0.50.101 (PROFTP TRAFFIC TO DMZ)
  â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiport --dport 990 -j DNAT --to-destination 10.0.50.101
 â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 10000:10100 -j DNAT --to-destination 10.0.50.101 (PROFTP TRAFFIC TO DMZ)
 â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 443 -j DNAT --to-destination 10.0.60.102 (WAZUH WEB PAGE TO CONFIG)
 â‡¨
 â‡¨
 â‡¨ iptables -t nat -L -nv
 â‡¨ service iptables save
 â‡¨ nano /etc/sysctl.conf
    âž£ net.ipv4.ip_forward = 1
 â‡¨ sysctl -p /etc/sysctl.conf
 â‡¨ service network restart
 
#################################################
##                                             ##
##           EASY-RSA INSTALLATION             ##
##                                             ##
#################################################
 
 â‡¨ sudo amazon-linux-extras install epel
 â‡¨ yum install openvpn easy-rsa -y
 â‡¨ cp -r /usr/share/easy-rsa/ /etc/
 â‡¨ cd /etc/easy-rsa/3/
 â‡¨ nano vars (Copy vars.exemple from ubuntu easy-rsa)
 â‡¨ Edit Certs Infos
 â‡¨ nano openssl-easyrsa.cnf (COMMENT #RANDLIFE)
 â‡¨ ./easyrsa build ca www.enta.pt (create ca)
 â‡¨ cd pki/reqs/
 â‡¨ nano ca.req (paste req from the inova server)
 â‡¨ ./easyrsa sign-req ca ca
 â‡¨ cd /etc/easy-rsa/3/pki/issued/
 â‡¨ cat cat.crt (copy and paste it on inova (/pki/)
 
 
#################################################
##                                             ##
##                OPENVPN SETUP                ##
##                                             ##
#################################################

â‡¨ amazon-linux-extras install epel -y
â‡¨ yum update -y
â‡¨ yum install openvpn
â‡¨ cd /etc/openvpn
â‡¨ openvpn --genkey --secret ta.key
â‡¨ openssl dhparam -out dh2048.pem 2048
â‡¨ nano server_ss.conf
  ##THE DAFAULT DOCCUMENT IS IN "OpenVPN Files/server_ss.conf" grab it and edit!
â‡¨ nano server_ra.conf
  ##THE DAFAULT DOCCUMENT IS IN "OpenVPN Files/server_ra.conf" grab it and edit!
â‡¨ Copy from control.inova.pt the CA's that you have create to OPENVPN (vpn.enta.pt.crt | vpn.enta.pt.key | ca.crt) and paste inside openvpn folder.
â‡¨ systemctl disable openvpn@server_ss
â‡¨ systemctl stop openvpn@server_ss
â‡¨ systemctl disable openvpn@server_ra
â‡¨ systemctl stop openvpn@server_ra


##Only activate this when the configuration site-to-site is done. ENTA > Inova > Remote Client (Orther to start)

â‡¨ systemctl enable --now openvpn@server_ss
â‡¨ systemctl enable --now openvpn@server_ra

â‡¨ PING: 172.31.128.101 (INOVA:DMZ) 172.31.129.101(INOVA:CENTRAL) 172.31.129.102 (WAZUH:INOVA) 172.31.129.103 (INOVA:marketing) 172.31.129.104(INOVA:SALES)
