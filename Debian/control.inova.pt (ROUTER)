 ã€Ž ROUTER ã€
 
 ã€Š ð™Šð™£ ð™©ð™ð™š ð™§ð™¤ð™ªð™©ð™šð™§ ð™¬ð™žð™¡ð™¡ ð™—ð™š ð™¬ð™ð™šð™§ð™š ð™–ð™¡ð™¡ ð™©ð™ð™š ð™žð™£ð™›ð™¤ð™§ð™¢ð™–ð™©ð™žð™¤ð™£ ð™šð™£ð™©ð™šð™§ð™¨ ð™–ð™£ð™™ ð™¡ð™šð™–ð™«ð™šð™¨ ð™›ð™§ð™¤ð™¢ ð™¢ð™® ð™¥ð™§ð™žð™«ð™–ð™©ð™š ð™£ð™šð™©ð™¬ð™¤ð™§ð™ !
 ð™›ð™¤ð™§ ð™—ð™šð™œð™žð™£ð™£ð™žð™£ð™œ, ð™„'ð™¡ð™¡ ð™˜ð™¤ð™£ð™›ð™žð™œð™ªð™§ð™š ð™‰ð˜¼ð™ ð™›ð™¤ð™§ ð™©ð™ð™š ð˜¿ð™ˆð™• ð™–ð™£ð™™ ð™©ð™ð™š ð™¤ð™©ð™ð™šð™§ ð™¥ð™§ð™žð™«ð™–ð™©ð™š ð™£ð™šð™©ð™¬ð™¤ð™§ð™  ð™¢ð™–ð™˜ð™ð™žð™£ð™šð™¨. ã€‹
 
 â‡¨ AWS: Actions > Networking > Change source/destination checking > STOP (This will allow NAT)
 â‡¨ sudo hostnamectl set-hostname control.inova.pt (Server Domain)
 â‡¨ nano keypair.pem (Inside paste your private key that you used to connect to the machine)
 â‡¨ sudo chmod 400 keypair.pem (Give Permissions to the key file)
 
 â‡¨ sudo su - (Root user)
 â‡¨ apt update && apt upgrade -y (Update system)
 
#################################################
##                                             ##
##                     NAT                     ##
##                                             ##
#################################################
 
 â‡¨ apt install netfilter-persistant iptables-persistant
 â‡¨ iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
 â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m multiport --dport 80,443 -j DNAT --to-destination 172.31.128.101 (Redirects the HTTP/HTTPS Traffic to DMZ) 
 â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 990 -j DNAT --to-destination 172.31.128.101 (FTP TRAFFIC TO DMZ)
 â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 10000:10100 -j DNAT --to-destination 172.31.128.101 (FTP TRAFFIC TO DMZ)
 â‡¨ iptables -t nat -A PREROUTING -i eth0 -p tcp -m tcp --dport 3389 -j DNAT --to-destination 172.31.129.103 (Redirects RDP to Sales Client)
 â‡¨ iptables -t nat -L -nv (Check)
 â‡¨ netfilter-persistant save (Save Configurations)
 â‡¨ nano /etc/sysctl.conf
   > Uncomment # net.ipv4.ip_forward=1
 
 â‡¨ sysctl -p (If the awnser is 1, then your good to go)
 â‡¨ ip a (Copy MAC Address from your eth2, thats the 2 network interface that you attached to your router.)
 â‡¨ nano /etc/netplan/50-cloud-init.yaml
   > Copy eth1 block in your netplan (should look like this)
   eth1:
            dhcp4: true
            dhcp4-overrides:
                route-metric: 200
            dhcp6: false
            match:
                macaddress: 06:ae:39:d4:dc:df
            set-name: eth1

   â‡¨ Change the eth1 to eth2, paste above "set-name: eth1" the block that you have copied, Clear the Mac Adress and paste the one from eth2 (Should Look like this)
   eth2:
            dhcp4: true
            dhcp4-overrides:
                route-metric: 200
            dhcp6: false
            match:
                macaddress: (eth2 mac adress here from ip a)
            set-name: eth2 
   
    
    
    
#################################################
##                                             ##
##                 EASY-RSA                    ##
##                                             ##
#################################################

    â‡¨ apt install easy-rsa
    â‡¨ cp -r /usr/share/easy-rsa/ /etc/
    â‡¨ cd /etc/easy-rsa/
    â‡¨ ./easyrsa init-pki
    â‡¨ ./easyrsa build-ca inova.pt subca
    â‡¨ cd /etc/easy-rsa/pki/reqs/
    â‡¨ cat ca.req (copy and paste on ec2 router, ( /pki/reqs/ )
    â‡¨ ./easyrsa build-server-full www.inova.pt nopass
    
    
    
#################################################
##                                             ##
##                   DNS                       ##
##                                             ##
#################################################

    â‡¨ apt install bind9
    â‡¨ cd /etc/bind/
    â‡¨ nano named.conf.options
      #UNCOMMENT
      forwarders {
        8.8.8.8;
      };
    
    â‡¨ cp db.local db.inova.pt
    â‡¨ cp db.127 db.31.172
    â‡¨ mv db.inova.pt /var/lib/bind/
    â‡¨ mv db.31.172 /var/lib/bind/
    â‡¨ cd /var/lib/bind/
    â‡¨ nano db.inova.pt
      #PASTE THIS FORWARDZONE
      ;
; BIND data file for local loopback interface
;
$TTL    604800
@       IN      SOA     inova.pt. root.inova.pt. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
@               IN      NS              inova.pt.
@               IN      A               172.31.35.185
control         IN      A               172.31.35.185
central         IN      A               172.31.129.101
wazuh           IN      A               172.31.129.102
marketing       IN      A               172.31.129.103
sales           IN      A               172.31.129.104
dmz             IN      A               172.31.128.101
    
    â‡¨ cd /etc/bind/
    â‡¨ nano named.conf.local 
      #PASTE 
      zone "inova.pt" {
        type master;
        file "/var/lib/bind/db.inova.pt";
      };

    â‡¨  systemctl restart bind9
    â‡¨ nslookup domain IP
    â‡¨ dig domain IP
    
    
#################################################
##                                             ##
##                OPENVPN SETUP                ##
##                                             ##
#################################################
    
    â‡¨ apt install openvpn
    â‡¨ cd /etc/openvpn/
    â‡¨ nano server_ss.conf
      ##THE DAFAULT DOCCUMENT IS IN "OpenVPN Files/server_ss.conf" grab it and edit!
      
    â‡¨ systemctl disable openvpn@server_ss
    â‡¨ systemctl stop openvpn@server_ss
    
    ##Only activate this when the configuration site-to-site is done. ENTA > Inova > Remote Client (Orther to start)
    â‡¨ systemctl enable --now openvpn@server_ss
    â‡¨ ip a (Check Tunnel)
    â‡¨ PING: 10.0.50.101 (ENTA:DMZ) 10.0.60.101 (ENTA:CENTRAL) 10.0.60.102 (WAZUH:ENTA) 10.0.60.103 (ENTA:SALES) 10.0.60.104 (INOVA:Marketing)
    
    
   
