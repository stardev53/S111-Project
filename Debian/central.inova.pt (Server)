『 𝙎𝙚𝙧𝙫𝙚𝙧 』

《 𝘌𝘮𝘢𝘪𝘭 𝘚𝘦𝘳𝘷𝘦𝘳 / 𝘕𝘐𝘚 / 𝘕𝘍𝘚 / 𝘙𝘈𝘐𝘋 5 》

❗❗ 𝘐𝘧 𝘺𝘰𝘶 𝘥𝘪𝘥 𝘕𝘈𝘛 𝘰𝘯 𝘙𝘰𝘶𝘵𝘦𝘳 (𝘤𝘰𝘯𝘵𝘳𝘰𝘭.𝘪𝘯𝘰𝘷𝘢.𝘱𝘵) 𝘺𝘰𝘶 𝘮𝘢𝘺 𝘤𝘰𝘯𝘵𝘪𝘯𝘶𝘦 𝘵𝘩𝘦 𝘪𝘯𝘴𝘵𝘳𝘶𝘤𝘵𝘪𝘰𝘯𝘴.

⇨ sudo hostnamectl set-hostname central.inova.pt (Set Server Domain)
⇨ sudo su - (Root)
⇨ nano /etc/netplan/50-cloud-init.yaml
  > dhcp4-overrides:
        use-dns: false
        use-routes: false
    nameservers:
        addresses: [ 8.8.8.8 ]           
    routes:
        - to: 0.0.0.0/0
          via: 172.31.129.100 (GATEWAY IP)
          on-link: true
⇨ netplan try
⇨ netplan apply
⇨ ping 1.1.1.1 (If it ping, you have internet acess)
⇨ apt update && apt upgrade -y

❗❗ After making DNS you can continue this step.

⇨ nano /etc/netplan/50-cloud-init.yaml
  #CHANGE 8.8.8.8 TO DNS IP (172.31.129.100)
⇨ netplan try
⇨ netplan apply
⇨ nslookup www.inova.pt

##RAID 5 SETUP
##Create 3 Disks on AWS Volumes and Attach to central.inova.pt (1GB DISKS)

⇨  lsblk (check if the 3 disks are attached)
⇨ gdisk /dev/xvdf         | o 》Y 》n 》ENTER 》ENTER 》ENTER 》 fd00 》w 》Y | 
⇨ gdisk /dev/xvdg         | o 》Y 》n 》ENTER 》ENTER 》ENTER 》 fd00 》w 》Y | 
⇨ gdisk /dev/xvdh         | o 》Y 》n 》ENTER 》ENTER 》ENTER 》 fd00 》w 》Y | 
⇨ lsblk
⇨ mdadm --create /dev/md0 --level 5 --raid-devices 3 (DISK)1 (DISK)1 (DISK)1 
⇨ mdadm --detail /dev/md0 (Only advance when the Rebuild Status is 100% clean)
⇨ cryptsetup luksFormat --hash=sha512 --key-size=512 --cipher=aes-xts-plain64 --verify-passphrase /dev/md0 (Super@Passw0rd)
⇨ cryptsetup luksOpen /dev/md0 md0_crypt
⇨ pvcreate /dev/mapper/md0_crypt
⇨ vgcreate vg0 /dev/mapper/md0_crypt
⇨ lvcreate -n vg0lv0 -l +100%FREE vg0
⇨ mkfs.xfs /dev/vg0/vg0lv0
⇨ mkdir /mnt/raid5_homes
⇨ mount /dev/vg0/vg0lv0 /mnt/raid5_homes/
⇨ lsblk
⇨ cat /etc/mtab (Copy the last line)
⇨ nano /etc/fstab ( Paste lines with " ,nofail ")

⇨ When you reboot the server:
  > cryptsetup luksOpen /dev/md0 md0_crypt (to open md0_crypt and vg)
  > mount -a (to mount the folder to ride5)

##NIS && NFS
⇨ nano /etc/hosts ( 172.31.129.101 central.inova.pt inovasrv.inova.pt inova.pt )
⇨ apt update && apt -y upgrade && apt install nfs-kernel-server
⇨ nano /etc/exports
  > /mnt/raid5_homes/ *(rw,sync,no_subtree_check,no_root_squash)
⇨ exportfs -a
⇨ systemctl enable --now nfs-kernel-server
⇨ adduser maria --home /mnt/raid5_homes/maria
⇨ echo xfce4-session > /mnt/raid5_homes/maria/.xsession
⇨ chown maria:maria /mnt/raid5_homes/maria/.xsession
⇨ adduser miguel --home /mnt/raid5_homes/miguel
⇨ echo xfce4-session > /mnt/raid5_homes/miguel/.xsession
⇨ chown miguel:miguel /mnt/raid5_homes/miguel/.xsession 

⇨ (Go to Sales and Marketing Clients to configure nfs)


⇨ apt -y install nis
  - NIS DOMAIN: enta.pt
⇨ nano /etc/default/nis
  - NISSERVER=master
⇨ nano /etc/ypserv.securenets
  # This line gives access to everybody. PLEASE ADJUST! (change 0.0.0.0 / 0.0.0.0 to mask and private network)
  255.255.255.0         172.31.0.0
  # add to the end: IP range you allow to access
  255.255.255.0         172.31.129.0
⇨ nano /var/yp/Makefile
  - MERGE_PASSWD=true
  - MERGE_GROUP=true
⇨ Update Database: /usr/lib/yp/ypinit -m
  list, type a <control D>.
    next host to add:  entasrv.enta.pt
    next host to add:     # Ctrl+D key
  The current list of NIS servers looks like this:
⇨ systemctl restart nis
⇨ after nis restart: (If you added users in local server, apply them to NIS database)
  - cd /var/yp
  - make

⇨ (Go to Sales or Marketing client to continue NIS Configuration.)
