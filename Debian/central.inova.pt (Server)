ã€Ž ð™Žð™šð™§ð™«ð™šð™§ ã€

ã€Š ð˜Œð˜®ð˜¢ð˜ªð˜­ ð˜šð˜¦ð˜³ð˜·ð˜¦ð˜³ / ð˜•ð˜ð˜š / ð˜•ð˜ð˜š / ð˜™ð˜ˆð˜ð˜‹ 5 ã€‹

â—â— ð˜ð˜§ ð˜ºð˜°ð˜¶ ð˜¥ð˜ªð˜¥ ð˜•ð˜ˆð˜› ð˜°ð˜¯ ð˜™ð˜°ð˜¶ð˜µð˜¦ð˜³ (ð˜¤ð˜°ð˜¯ð˜µð˜³ð˜°ð˜­.ð˜ªð˜¯ð˜°ð˜·ð˜¢.ð˜±ð˜µ) ð˜ºð˜°ð˜¶ ð˜®ð˜¢ð˜º ð˜¤ð˜°ð˜¯ð˜µð˜ªð˜¯ð˜¶ð˜¦ ð˜µð˜©ð˜¦ ð˜ªð˜¯ð˜´ð˜µð˜³ð˜¶ð˜¤ð˜µð˜ªð˜°ð˜¯ð˜´.

â‡¨ sudo hostnamectl set-hostname central.inova.pt (Set Server Domain)
â‡¨ sudo su - (Root)
â‡¨ nano /etc/netplan/50-cloud-init.yaml
  > dhcp4-overrides:
        use-dns: false
        use-routes: false
    nameservers:
        addresses: [ 8.8.8.8 ]           
    routes:
        - to: 0.0.0.0/0
          via: 172.31.129.100 (GATEWAY IP)
          on-link: true
â‡¨ netplan try
â‡¨ netplan apply
â‡¨ ping 1.1.1.1 (If it ping, you have internet acess)
â‡¨ apt update && apt upgrade -y

â—â— After making DNS you can continue this step.

â‡¨ nano /etc/netplan/50-cloud-init.yaml
  #CHANGE 8.8.8.8 TO DNS IP (172.31.129.100)
â‡¨ netplan try
â‡¨ netplan apply
â‡¨ nslookup www.inova.pt

#################################################
##                                             ##
##                  RAID 5                     ##
##                                             ##
#################################################

##Create 3 Disks on AWS Volumes and Attach to central.inova.pt (1GB DISKS)

â‡¨  lsblk (check if the 3 disks are attached)
â‡¨ gdisk /dev/xvdf         | o ã€‹Y ã€‹n ã€‹ENTER ã€‹ENTER ã€‹ENTER ã€‹ fd00 ã€‹w ã€‹Y | 
â‡¨ gdisk /dev/xvdg         | o ã€‹Y ã€‹n ã€‹ENTER ã€‹ENTER ã€‹ENTER ã€‹ fd00 ã€‹w ã€‹Y | 
â‡¨ gdisk /dev/xvdh         | o ã€‹Y ã€‹n ã€‹ENTER ã€‹ENTER ã€‹ENTER ã€‹ fd00 ã€‹w ã€‹Y | 
â‡¨ lsblk
â‡¨ mdadm --create /dev/md0 --level 5 --raid-devices 3 (DISK)1 (DISK)1 (DISK)1 
â‡¨ mdadm --detail /dev/md0 (Only advance when the Rebuild Status is 100% clean)
â‡¨ cryptsetup luksFormat --hash=sha512 --key-size=512 --cipher=aes-xts-plain64 --verify-passphrase /dev/md0 (Super@Passw0rd)
â‡¨ cryptsetup luksOpen /dev/md0 md0_crypt
â‡¨ pvcreate /dev/mapper/md0_crypt
â‡¨ vgcreate vg0 /dev/mapper/md0_crypt
â‡¨ lvcreate -n vg0lv0 -l +100%FREE vg0
â‡¨ mkfs.xfs /dev/vg0/vg0lv0
â‡¨ mkdir /mnt/raid5_Storage
â‡¨ mount /dev/vg0/vg0lv0 /mnt/raid5_Storage/
â‡¨ lsblk
â‡¨ cat /etc/mtab (Copy the last line)
â‡¨ nano /etc/fstab ( Paste lines with " ,nofail ")

â‡¨ When you reboot the server:
  > cryptsetup luksOpen /dev/md0 md0_crypt (to open md0_crypt and vg)
  > mount -a (to mount the folder to ride5)

#################################################
##                                             ##
##                 NFS && NIS                  ##
##                                             ##
#################################################

â‡¨ nano /etc/hosts ( 172.31.129.101 central.inova.pt inovasrv.inova.pt inova.pt )
â‡¨ apt update && apt -y upgrade && apt install nfs-kernel-server
â‡¨ nano /etc/exports
  > /var/homes/ *(rw,sync,no_subtree_check,no_root_squash)
â‡¨ exportfs -a
â‡¨ systemctl enable --now nfs-kernel-server

â‡¨ (Go to Sales and Marketing Clients to configure nfs)


â‡¨ apt -y install nis
  - NIS DOMAIN: enta.pt
â‡¨ nano /etc/default/nis
  - NISSERVER=master
â‡¨ nano /etc/ypserv.securenets
  # This line gives access to everybody. PLEASE ADJUST! (change 0.0.0.0 / 0.0.0.0 to mask and private network)
  255.255.255.0         172.31.0.0
  # add to the end: IP range you allow to access
  255.255.255.0         172.31.129.0
â‡¨ nano /var/yp/Makefile
  - MERGE_PASSWD=true
  - MERGE_GROUP=true
â‡¨ Update Database: /usr/lib/yp/ypinit -m
  list, type a <control D>.
    next host to add:  entasrv.enta.pt
    next host to add:     # Ctrl+D key
  The current list of NIS servers looks like this:
â‡¨ systemctl restart nis

â‡¨ (Go to Sales or Marketing client to continue NIS Configuration.)



#################################################
##                                             ##
##                E-MAIL SERVER                ##
##                                             ##
#################################################

â‡¨ sudo hostnamectl set-hostname emailsrv.azores.pt
â‡¨ apt update && apt upgrade -y
â‡¨ sudo su -

â‡¨ apt -y install postfix postfix-doc dovecot-imapd dovecot-pop3d sasl2-bin
   - inova.ptt
   
â‡¨ dpkg-reconfigure postfix
   - inova.pt
   - ubuntu
   - Skip
   - No
   - Clear the line
   - 0
   - +
   - ipv4
   
â‡¨ nano /etc/postfix/main.cf
   #Change
   smtpd_tls_cert_file=/etc/ssl/certs/azores.pt.crt
   smtpd_tls_key_file=/etc/ssl/private/azores.pt.key
   
â‡¨ nano /etc/postfix/master.cf

   #uncomment 1Âº Group:
   submission inet n       -       y       -       -       smtpd
   -o syslog_name=postfix/submission
   -o smtpd_tls_security_level=encrypt
   -o smtpd_sasl_auth_enable=yes
   #Add bellow -o smtpd_sasl_auth_enable=yes:
   -o smtpd_client_restrictions=permit_sasl_authenticated,reject
   
   #uncomment 2Âº Group:
   smtps     inet  n       -       y       -       -       smtpd
   -o syslog_name=postfix/smtps
   -o smtpd_tls_wrappermode=yes
   -o smtpd_sasl_auth_enable=yes
   -o smtpd_client_restrictions=permit_sasl_authenticated,reject

â‡¨ nano /etc/default/saslauthd
    #EDIT
    START=yes
    OPTIONS="-c -m /var/spool/postfix/var/run/saslauthd"
    
â‡¨ postconf -e 'home_mailbox = Maildir/'
â‡¨ nano /etc/dovecot/conf.d/10-auth.conf
  #Uncomment and EDIT
  disable_plaintext_auth = no
  
â‡¨ nano /etc/dovecot/conf.d/10-mail.conf
  #UNCOMMENT
  mail_location = maildir:~/Maildir
  #comment
  #mail_location = mbox:~/mail:INBOX=/var/mail/%u
  
â‡¨ nano /etc/dovecot/conf.d/10-ssl.conf
  > ssl = yes
  #UNCOMMENT AND EDIT:
  ssl_cert = </etc/ssl/certs/azores.pt.crt
  ssl_key = </etc/ssl/private/azores.pt.key
  
â‡¨ cd /etc/skel/
  > maildirmake.dovecot Maildir
  
â‡¨ adduser postfix sasl
â‡¨ adduser dovecot sasl
â‡¨ systemctl restart saslauthd.service postfix dovecot

----------------------------------------------------------------------
â—â— You only create Users after installing NFS, NIS and Email Server â—â—
â‡¨ adduser maria --home /mnt/homes/maria
â‡¨ echo xfce4-session > /mnt/homes/maria/.xsession
â‡¨ chown maria:maria /mnt/homes/maria/.xsession

â—â—After Creating Users do this to update NIS DB
â‡¨ cd /var/yp
â‡¨ make
â‡¨ systemctl restart nis

â‡¨ ss -tulp | grep master
 #CONFIRM PORTS:
  > 25
  > 465
  > 587
â‡¨ ss -tulp | grep dovecot
 #CONFIRM PORTS:
  > 110
  > 143
  > 993
  > 995
